<!DOCTYPE HTML>
<html>
<head>
    <title>CSS Regions - NamedFlow API</title>
    <link rel="stylesheet" type="text/css" href="shared-style.css" media="all" />
    <meta charset="UTF-8">
    <style type="text/css">

    article.content{
        -webkit-flow-into: article;  
    }

    section {  
        -webkit-region-break-before: always;
    }

    .region{
        -webkit-flow-from: article;
        width: 500px;
        height: 100px;
        opacity: 0.0;
        margin: 0;
        padding: 0;
        -webkit-transition: opacity 0.5s;
    }
    .visible{
        opacity: 1.0; 
    }

    .tableofcontents {
        width: 20%;
        margin: 2% auto;
        padding: 20px;
        float: left;
    }

    .page{
        width: 60%;
        padding: 30px;
        min-width: 500px;
        float: left;
        border-left: 1px solid lightgray;
    }

    .container {
        width:60%;
        margin: 1% auto;
        min-width: 770px;
    }

    #regions-container {
        position: relative;
        -webkit-transition: height 0.5s;
    }
    #regions-scroller {
        position: relative;
        overflow: hidden;
        -webkit-transition: -webkit-transform 0.5s;
    }

    ul {
        list-style-type: none; 
    }

    li {
        margin-bottom: 1em;
    }

    </style>
</head>
<body>    

    <div class="container">
        <article>
            <h1>Using javascript to retrieve regions where content is flowed</h1>
             <section>
                <p class="tip"><strong>Hint:</strong> Click on different parts on the table of contents to read different parts of the document.</p>
            </section>
        </article>

        <ul class="tableofcontents">
            <li> <a href="#introduction">Introduction</a> </li>
            <li> <a href="#chapter1">Typography demo</a> </li>
            <li> <a href="#chapter2">Filler text</a> </li>
        </ul>
    
        <div class="page" id="regions-container">
            <div id="regions-scroller"></div>
        </div>
    </div>

    

    <article class="content">
       
        <section id="introduction">
            <p>
                When content is being flowed in a region chain, the regions in which it actually ends up flowing may vary. The actual regions in which certain content is being flowed can be fetched using the <code>getRegionsByContent</code> function, available on the <code>NamedFlow</code> object. 
            </p>
            <p>
                <code>getRegionsByContent</code> receives a <code>contentNode</code> as a parameter, and returns a <code>NodeList</code> of regions in which the content is flowed.
            </p>
            <p>
                In this sample, you can select using the table of contents which sections of the document to display at one time. The regions in which the selected content is flowed become visible, while the rest are set to invisible. 
            </p>
        </section>

        <section id="chapter1">
            <p>
                The quick brown fox jumps over the lazy dog.
                The quick brown fox jumps over the lazy dog.
                The quick brown fox jumps over the lazy dog.
                The quick brown fox jumps over the lazy dog.
                The quick brown fox jumps over the lazy dog.
                The quick brown fox jumps over the lazy dog.
                The quick brown fox jumps over the lazy dog.
            </p>
            <p>
                The quick brown fox jumps over the lazy dog.
                The quick brown fox jumps over the lazy dog.
                The quick brown fox jumps over the lazy dog.
                The quick brown fox jumps over the lazy dog.
                The quick brown fox jumps over the lazy dog.
                The quick brown fox jumps over the lazy dog.
                The quick brown fox jumps over the lazy dog.
            </p>
            <p>
                The quick brown fox jumps over the lazy dog.
                The quick brown fox jumps over the lazy dog.
                The quick brown fox jumps over the lazy dog.
                The quick brown fox jumps over the lazy dog.
                The quick brown fox jumps over the lazy dog.
                The quick brown fox jumps over the lazy dog.
                The quick brown fox jumps over the lazy dog.
            </p>
            <p>
                The quick brown fox jumps over the lazy dog.
                The quick brown fox jumps over the lazy dog.
                The quick brown fox jumps over the lazy dog.
                The quick brown fox jumps over the lazy dog.
                The quick brown fox jumps over the lazy dog.
                The quick brown fox jumps over the lazy dog.
                The quick brown fox jumps over the lazy dog.
            </p>
            <p>
                The quick brown fox jumps over the lazy dog.
                The quick brown fox jumps over the lazy dog.
                The quick brown fox jumps over the lazy dog.
                The quick brown fox jumps over the lazy dog.
                The quick brown fox jumps over the lazy dog.
                The quick brown fox jumps over the lazy dog.
                The quick brown fox jumps over the lazy dog.
            </p>
        </section>

        <section id="chapter2">
        <p>
            Lorem ipsum dolor sit amet, consectetur adipiscing elit. Duis sed ligula eget elit dapibus ultricies. Sed vitae sem in dolor porttitor dictum eu in turpis. Cras dui ligula, pellentesque vitae imperdiet at, molestie nec tortor. Fusce fringilla ante eget metus iaculis fringilla. Nulla facilisi. Cras porta interdum nulla elementum ornare. Morbi at arcu elit. Sed mattis aliquam purus ut molestie. Sed egestas lacus eget dui malesuada eget feugiat odio suscipit. Proin lobortis justo eget augue cursus in ultricies urna ultricies. Fusce ut libero sit amet enim scelerisque tempus. Ut elementum tempus dignissim. In vitae mauris magna, non faucibus tellus. Ut velit sem, auctor eget aliquet sed, sodales ut risus.
        </p>

        <p>
            Cum sociis natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Vivamus libero libero, congue et tempor sit amet, condimentum sed erat. In rutrum, orci et laoreet lacinia, lacus mauris mattis turpis, vel dignissim urna risus eget turpis. Duis ligula tortor, vehicula ut porta vel, varius eget erat. Suspendisse sem nulla, placerat in viverra et, auctor id diam. Nulla consequat molestie enim a euismod. Nam interdum sapien non orci porttitor quis bibendum neque mattis. Sed at enim diam, dapibus rhoncus est. Sed adipiscing justo quis sapien aliquam facilisis. Integer eget diam ut neque placerat molestie quis ac odio. Sed laoreet bibendum tellus, aliquet ultricies nulla congue id. Vivamus vulputate ultricies dui a imperdiet. Morbi quis arcu purus, condimentum vulputate arcu. Quisque eros purus, pharetra non scelerisque in, varius a massa. Curabitur at ipsum ante, quis sollicitudin arcu.
        </p>
        </section>

    </article>

    <script type="text/javascript" src="shared-script.js"></script>
    <script type="text/javascript">
        var namedFlow = document.webkitGetFlowByName("article");
        function ensureNoOverflow()
        {
            var added = 0;
            while (namedFlow.firstEmptyRegionIndex == -1) {
                var newRegion = document.createElement("div");
                newRegion.classList.add("region");
                document.getElementById("regions-scroller").appendChild(newRegion);
                ++added;

                // FIXME: Workaround for Webkit bug 92506
                // Throttle the maximum amount of regions to be added
                if (added == 40)
                    break;
            }
        }

        function makeRegionsVisibleForContent(content) {
            contentRegions = namedFlow.getRegionsByContent(content);
            var len = contentRegions.length;
            var totalHeight = 0;
            var contentTop = 0;
            var regionsTop = document.querySelector('.region').getBoundingClientRect().top;


            for (var i = 0; i < len; ++i) {
                if (i == 0) {
                    contentTop = contentRegions[i].getBoundingClientRect().top;
                }
                if (i == len - 1) {
                    var rect = contentRegions[i].getBoundingClientRect();
                    totalHeight = rect.top - contentTop + rect.height;
                }
                contentRegions[i].classList.add("visible");
            }

            var scroller = document.querySelector('#regions-scroller');
            scroller.style.webkitTransform = "translateY(" + (regionsTop - contentTop) + "px)";

            var container = document.querySelector('#regions-container');
            container.style.height = totalHeight + "px";
        }

        function revealSection(section)
        {
            ensureNoOverflow();
            // make all regions invisible
            var regions = document.querySelectorAll(".visible");
            for (var i = 0; i < regions.length; ++i) {
                regions[i].classList.remove("visible");
            }

            makeRegionsVisibleForContent(section);
        }

        document.addEventListener("DOMContentLoaded", function() {    
            var section = document.querySelector("#introduction");
            revealSection(section);
        });

        document.addEventListener("click", function(evt) {
            if (evt.target && evt.target.nodeName == "A") {
                var sectionId = evt.target.href;
                sectionId = sectionId.match(/#.*$/);
                section = document.querySelector(sectionId);
                revealSection(section);

                //cancel navigation
                evt.preventDefault();
            }
        })
    </script>
</body>
</html>
